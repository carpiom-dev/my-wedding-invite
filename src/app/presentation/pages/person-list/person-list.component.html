<mat-toolbar color="primary">
  <span>üíç Lista de invitados</span>
  <span class="spacer"></span>
  <button mat-raised-button color="accent" (click)="openDialog()">Agregar</button>
</mat-toolbar>
<div style="padding: 12px; font-size: 18px; font-weight: 600;">
  Total Admisiones: {{ totalAdmisiones() }}
</div>
<mat-card>
<mat-form-field appearance="outline" style="width: 300px; margin-bottom: 16px;">
  <mat-label>Buscar invitado</mat-label>
  <input matInput (input)="filter.set($any($event.target).value)" placeholder="Nombre, apellido o tel√©fono">
  <button *ngIf="filter()" matSuffix mat-icon-button (click)="filter.set('')">
    <mat-icon>close</mat-icon>
  </button>
</mat-form-field>
  <table mat-table [dataSource]="pagedData()" class="mat-elevation-z2">

    <!-- Selecci√≥n -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="toggleAll($event.checked)"
          [checked]="allSelected()"
          [indeterminate]="someSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let p">
        <mat-checkbox
          [(ngModel)]="p.selected"
          (change)="updateSelection()"
          [disabled]="p.enviado">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- N√∫mero de fila -->
    <ng-container matColumnDef="index">
      <th mat-header-cell *matHeaderCellDef>#</th>
      <td mat-cell *matCellDef="let row; let i = index">
        {{ i + 1 }}
      </td>
    </ng-container>

    <!-- Nombre -->
    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let p">
        {{ p.nombre }} {{ p.apellido }}
        @if(p.enviado){
          <mat-icon color="primary" style="font-size:18px; margin-left:4px;">check_circle</mat-icon>
        }
      </td>
    </ng-container>

    <!-- Tel√©fono -->
    <ng-container matColumnDef="telefono">
      <th mat-header-cell *matHeaderCellDef>Tel√©fono</th>
      <td mat-cell *matCellDef="let p">{{ p.telefono }}</td>
    </ng-container>

    <!-- Admisiones -->
    <ng-container matColumnDef="cantidadAdmisiones">
      <th mat-header-cell *matHeaderCellDef>Admisiones</th>
      <td mat-cell *matCellDef="let p">
        {{ p.cantidadAdmisiones ?? 0 }}
      </td>
    </ng-container>

    <!-- Confirmado -->
<ng-container matColumnDef="confirmado">
  <th mat-header-cell *matHeaderCellDef> Confirmado </th>

  <td mat-cell *matCellDef="let p">

    <span
      class="badge"
      [ngClass]="{
        'badge-si': p.nota === 'SI',
        'badge-no': p.nota === 'NO',
        'badge-pendiente': !p.nota
      }"
    >
      @if(p.nota === 'SI'){ S√≠ }
      @if(p.nota === 'NO'){ No }
      @if(!p.nota){ Pendiente }
    </span>

  </td>
</ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let p" style="text-align:center;">
        <button mat-icon-button (click)="previewOne(p)" matTooltip="Vista previa">
          <mat-icon class="icon-preview">visibility</mat-icon>
        </button>

        <button mat-icon-button (click)="sendOne(p)" matTooltip="Enviar por WhatsApp">
          <mat-icon class="icon-whatsapp">send</mat-icon>
        </button>

        <button mat-icon-button (click)="openDialog(p)" matTooltip="Editar">
          <mat-icon class="icon-edit">edit</mat-icon>
        </button>

        <button mat-icon-button (click)="delete(p.id.value)" matTooltip="Eliminar">
          <mat-icon class="icon-delete">delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.not-sent]="!row.enviado">
    </tr>
  </table>
<mat-paginator
  [length]="filteredData().length"
  [pageSize]="pageSize()"
  [pageIndex]="pageIndex()"
  [pageSizeOptions]="[5, 10, 25]"
  (page)="pageIndex.set($event.pageIndex); pageSize.set($event.pageSize)">
</mat-paginator>
  <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:16px;">
    <button mat-stroked-button (click)="previewSelected()" [disabled]="selectedCount === 0">
      <mat-icon>visibility</mat-icon> Preview {{ selectedCount }}
    </button>

    <button mat-raised-button color="accent" (click)="sendSelected()" [disabled]="selectedCount === 0">
      <mat-icon>send</mat-icon> Enviar a {{ selectedCount }}
    </button>
  </div>
</mat-card>
