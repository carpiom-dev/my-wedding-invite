<mat-toolbar color="primary">
  <span>üíç Lista de invitados</span>
  <span class="spacer"></span>
  <button mat-raised-button color="accent" (click)="openDialog()">Agregar</button>
</mat-toolbar>

<mat-card>
  <table mat-table [dataSource]="data()" class="mat-elevation-z2">

    <!-- Selecci√≥n -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="toggleAll($event.checked)"
          [checked]="allSelected()"
          [indeterminate]="someSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let p">
        <mat-checkbox
          [(ngModel)]="p.selected"
          (change)="updateSelection()"
          [disabled]="p.enviado">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- Nombre -->
    <ng-container matColumnDef="nombre">
      <th mat-header-cell *matHeaderCellDef>Nombre</th>
      <td mat-cell *matCellDef="let p">
        {{ p.nombre }} {{ p.apellido }}
        <mat-icon *ngIf="p.enviado" color="primary" style="font-size:18px; margin-left:4px;">check_circle</mat-icon>
      </td>
    </ng-container>

    <!-- Tel√©fono -->
    <ng-container matColumnDef="telefono">
      <th mat-header-cell *matHeaderCellDef>Tel√©fono</th>
      <td mat-cell *matCellDef="let p">{{ p.telefono }}</td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="acciones">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let p" style="text-align:center;">
        <button mat-icon-button (click)="previewOne(p)" matTooltip="Vista previa">
          <mat-icon class="icon-preview">visibility</mat-icon>
        </button>

        <button mat-icon-button (click)="sendOne(p)" matTooltip="Enviar por WhatsApp">
          <mat-icon class="icon-whatsapp">send</mat-icon>
        </button>

        <button mat-icon-button (click)="openDialog(p)" matTooltip="Editar">
          <mat-icon class="icon-edit">edit</mat-icon>
        </button>

        <button mat-icon-button (click)="delete(p.id.value)" matTooltip="Eliminar">
          <mat-icon class="icon-delete">delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns" [class.not-sent]="!row.enviado"></tr>
  </table>

  <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:16px;">
    <button mat-stroked-button (click)="previewSelected()" [disabled]="selectedCount === 0">
      <mat-icon>visibility</mat-icon> Preview {{ selectedCount }}
    </button>
    <button mat-raised-button color="accent" (click)="sendSelected()" [disabled]="selectedCount === 0">
      <mat-icon>send</mat-icon> Enviar a {{ selectedCount }}
    </button>
  </div>
</mat-card>
